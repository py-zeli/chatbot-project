name: Deploy AWS Lambda

on:
  push:
    branches:
      - main  # üí° AJUSTE: Mantenha 'main' ou altere para a branch principal que dispara o deploy.
    paths:
      - 'TesteCloud/**' # üí° AJUSTE: Use o diret√≥rio completo para consist√™ncia.

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # 1. Criar o arquivo ZIP do c√≥digo
      - name: Zip Lambda code
        run: |
          # Navega para a pasta do c√≥digo.
          # Cria um ZIP que cont√©m APENAS o conte√∫do da pasta, n√£o a pasta TesteCloud em si.
          zip -r deployment-package.zip .
        working-directory: ./TesteCloud # üí° AJUSTE: Usando o diret√≥rio correto
      
      # 2. Configurar Credenciais da AWS
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1 # üí° AJUSTE: Mude para a sua regi√£o

      # 3. Deploy da Fun√ß√£o Lambda
      # A a√ß√£o aws-lambda-deploy ir√° pegar o ZIP e enviar para a fun√ß√£o.
      - name: Deploy Lambda function
        uses: aws-actions/aws-lambda-deploy@v1.1.0
        with:
          function-name: slackBotTests # ‚ö†Ô∏è Mude para o NOME EXATO da sua fun√ß√£o na AWS
          zip-file: ./TesteCloud/deployment-package.zip # Caminho para o arquivo ZIP
          # handler: script.lambda_handler # Opcional: Se quiser garantir o handler